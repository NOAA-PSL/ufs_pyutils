# Define the name of the Github actions/workflow.
name: Container Build Tests

# Define the Github triggers for which to launch the respective Github
# action/workflow.
on: [workflow_dispatch]
#  pull_request:
#    types: [opened]
#    
#  release:
#    types: [published]

#  schedule:
#    - cron: "0 0 * * *"

jobs:

  # Define the container image.
  build:
    runs-on: ubuntu-latest
    name: Run the ufs_pyutils container build tests.
        
    steps:

    # Build and install the Docker dependencies
    - name: Build and install the Docker dependencies.
      run: |
           sudo apt-get install git
           sudo apt-get remove docker docker-engine docker.io containerd runc
           sudo apt-get update
           sudo apt-get install ca-certificates curl gnupg lsb-release
           sudo mkdir -p /etc/apt/keyrings
           sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
           sudo echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
           sudo chmod a+r /etc/apt/keyrings/docker.gpg
           sudo apt-get update
           sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

    # Pull down the CentOS 7 Docker Engine and Singularity container.
    - name: Pull down the CentOS 7 Docker Engine and Singularity container.
      run: |
           docker pull noaaufsrnr/el7-docker-singularity:latest

    # Clone the ufs_pytils repository branch.
    - name: Checkout ufs_pyutils.
      uses: actions/checkout@v2
      with:
        path: ufs_pyutils

    # Build the Docker image.
    - name: Build the Docker image.
      run: |
           cd $GITHUB_WORKSPACE/ufs_pyutils/Docker
           docker build -f ubuntu20.04-miniconda-ufs_pyutils.docker --tag ubuntu20.04-miniconda-ufs_pyutils:latest .
           docker build -f ubuntu20.04.hello_world.docker --tag ubuntu20.04.hello_world.docker:latest .

           
